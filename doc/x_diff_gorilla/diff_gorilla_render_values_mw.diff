diff -i -E -b -w -B /home/xah/git/dpp/visi/src/gorilla_repl_original/render_values_mw.clj /home/xah/git/dpp/visi/src/gorilla_repl/render_values_mw.clj
8a9
>             [visi.runtime :as v-run]
21c24,26
<     (handler (assoc msg :transport (reify Transport
---
>     (handler
>      (assoc msg :transport
>             (reify Transport
24a30,48
>                 ;; (when (and (= (:value resp) 42) (:segmentID msg))
>                 ;;   (.start
>                 ;;    (Thread.
>                 ;;     (reify
>                 ;;       Runnable
>                 ;;       (run [_]
>                 ;;         (loop [cnt 43]
>                 ;;           (Thread/sleep 5000)
>                 ;;           (add-msg-for-session
>                 ;;            (:session resp)
>                 ;;            (assoc resp :value cnt
>                 ;;                   :segmentID (:segmentID msg)
>                 ;;                   :clear "true"))
>                 ;;           (recur (+ 1 cnt)))
>                 ;;         )))))
> 
>                 (let [all (conj (v-run/pull-session-info (:session resp)) resp)]
>                   (mapv
>                    (fn [r2]
26c50
<                                               (if-let [[_ v] (and (:as-html msg) (find resp :value))]
---
>                             (if-let [[_ v] (and (:as-html msg) (find r2 :value))]
32,33c56,59
<                                                 (assoc resp :value (json/generate-string (render/render v)))
<                                                 resp))
---
>                               (assoc r2 :value (json/generate-string (render/render v))
>                                      :id (:id resp)
>                                      :ignore (:ignore msg))
>                               resp))) all))

Diff finished.  Sun Nov 16 05:55:44 2014
